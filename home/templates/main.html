<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CI Python Linter</title>
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">

    <style>
        #editor {
            height: 500px;
            width: 100%;
            display: inline-block;
        }

        #code {
            display: none;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-md-3 mt-3">
                <a href="/"><img src="https://codeinstitute.s3.amazonaws.com/assets/logo.png" width="200"
                        alt="Code Institute Logo"></a>
            </div>
            <div class="col-md-4 text-center mt-3">
                <h1>CI Python Linter</h1>
            </div>
        </div>
    </div>
    <div class="container mt-3">
        <div class="row mt-3">
            <div class="col-8">
                <div id="editor">{{ content }}</div>
                <form id="codeform" method="POST">
                    {% csrf_token %}
                    <textarea type="hidden" name="code" id="code"></textarea>
                </form>
            </div>
            <div class="col-4">
                <p id="results"></p>
            </div>
        </div>
    </div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.8/ace.js"></script>
<script>
    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/monokai");
    editor.session.setMode("ace/mode/python");
    editor = ace.edit("editor");
    editor.setOption("wrap", true);
    editor.setOption("fontSize", 12);
    editor.focus();

    async function postForm() {

        const form = new FormData(document.getElementById("codeform"));

        const response = await fetch("/", {
            method: "POST",
            body: form,
        });

        const data = await response.text();

        if (response.ok) {
            document.getElementById("results").innerText = data;
        } else {
            throw new Error(data.error);
        }
    }

    editor.getSession().on("change", function (e) {
        document.getElementById("code").value = editor.getValue();
        postForm();
    });
</script>


</html>